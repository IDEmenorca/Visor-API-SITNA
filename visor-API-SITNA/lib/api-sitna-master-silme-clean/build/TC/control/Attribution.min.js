TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Attribution=function(){TC.Control.apply(this,arguments);this.apiAttribution="";this.mainDataAttribution="";this.dataAttributions=[];this.options.dataAttributions&&(this.dataAttributions=this.options.dataAttributions instanceof Array?this.options.dataAttributions:[this.options.dataAttributions])};TC.inherit(TC.control.Attribution,TC.Control);!function(){var t=TC.control.Attribution.prototype;t.CLASS="tc-ctl-attrib";TC.isDebug?t.template=TC.apiLocation+"TC/templates/Attribution.html":t.template=function(){dust.register(t.CLASS,i);function i(t,i){return t.w("<div><span>&copy; ").f(i.get(["api"],!1),i,"h",["s"]).w("</span> - ").h("i18n",i,{},{$key:"data"}).w(": ").x(i.getPath(!1,["mainData","site"]),i,{else:n,block:a},{}).x(i.get(["otherData"],!1),i,{block:r},{}).w('<div class="tc-ctl-attrib-other tc-collapsed">').s(i.get(["otherData"],!1),i,{block:e},{}).w("</div></div>")}i.__dustBody=!0;function n(t,i){return t.w("<span>&copy; ").f(i.getPath(!1,["mainData","name"]),i,"h").w("</span>")}n.__dustBody=!0;function a(t,i){return t.w('<span>&copy; <a href="').f(i.getPath(!1,["mainData","site"]),i,"h").w('" target="_blank">').f(i.getPath(!1,["mainData","name"]),i,"h").w("</a></span>")}a.__dustBody=!0;function r(t,i){return t.w(' - <span class="tc-ctl-attrib-cmd">').h("i18n",i,{},{$key:"others"}).w("...</span>")}r.__dustBody=!0;function e(t,i){return t.x(i.getPath(!1,["otherData",i.get(["$idx"],!1),"site"]),i,{else:o,block:s},{}).h("sep",i,{block:u},{})}e.__dustBody=!0;function o(t,i){return t.w("<span>&copy; ").f(i.getPath(!1,["otherData",i.get(["$idx"],!1),"name"]),i,"h").w("</span>")}o.__dustBody=!0;function s(t,i){return t.w('<span>&copy; <a href="').f(i.getPath(!1,["otherData",i.get(["$idx"],!1),"site"]),i,"h").w('" target="_blank">').f(i.getPath(!1,["otherData",i.get(["$idx"],!1),"name"]),i,"h").w("</a></span>")}s.__dustBody=!0;function u(t,i){return t.w(", ")}u.__dustBody=!0;return i};t.register=function(t){var i=this;TC.Control.prototype.register.call(i,t);i.apiAttribution=i.map.options.attribution||i.apiAttribution;var n=function(t){if(t){var n=t.wrap.getAttribution(TC.capabilities[t.url]);if(n)if(/IDENA/.test(n.name))i.mainDataAttribution={name:"IDENA",site:"http://idena.navarra.es/"};else{for(var a=!1,r=0;r<i.dataAttributions.length;r++)if(n.name===i.dataAttributions[r].name){a=!0;break}a||i.dataAttributions.push(n)}}},a=function(t){if(t){if(function(){if(t.map.workLayers.length>0){for(var i=t.map.workLayers.slice().reverse(),n=0;n<i.length;n++)if(i[n].url==t.url&&i[n].getVisibility())return!1;return!0}return!0}()){var n=t.wrap.getAttribution(TC.capabilities[t.url]);if(n){var a=i.dataAttributions.reduce(function(t,i,a){return i.name===n.name?a:t},-1);a>-1&&i.dataAttributions.splice(a,1)}}}};i.render();t.on(TC.Consts.event.LAYERADD,function(t){if(t.layer.wrap.getAttribution){n(t.layer);i.render()}});t.on(TC.Consts.event.LAYERREMOVE,function(t){if(t.layer.wrap.getAttribution){a(t.layer);i.render()}});t.on(TC.Consts.event.LAYERVISIBILITY,function(t){if(t.layer.wrap.getAttribution){t.layer.getVisibility()?n(t.layer):a(t.layer);i.render()}})};t.render=function(t){var i=this;i.renderData({api:i.apiAttribution,mainData:i.mainDataAttribution,otherData:i.dataAttributions},function(){i._$div.find("."+i.CLASS+"-cmd").on(TC.Consts.event.CLICK,function(){i._$div.find("."+i.CLASS+"-other").toggleClass(TC.Consts.classes.COLLAPSED)});$.isFunction(t)&&t()})}}();