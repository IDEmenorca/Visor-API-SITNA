TC.control=TC.control||{};TC.control.Scale||TC.syncLoadJS(TC.apiLocation+"TC/control/Scale");TC.control.ScaleSelector=function(){TC.control.Scale.apply(this,arguments);this.scales=null};TC.inherit(TC.control.ScaleSelector,TC.control.Scale);!function(){var e=TC.control.ScaleSelector.prototype;e.CLASS="tc-ctl-ss";TC.isDebug?e.template=TC.apiLocation+"TC/templates/ScaleSelector.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="ol-scale-line ol-unselectable"><nobr><select>').s(t.get(["scales"],!1),t,{block:n},{}).w('</select> <input type="button" value="').f(t.get(["screenSize"],!1),t,"h").w("''\" title=\"").h("i18n",t,{},{$key:"estimatedMapSize"}).w('" /></nobr></div>')}t.__dustBody=!0;function n(e,t){return e.w('<option value="').f(t.getPath(!0,[]),t,"h").w('"').h("eq",t,{block:o},{key:c,value:i}).w(">1:").h("math",t,{},{key:l,method:"round"}).w("</option>\n")}n.__dustBody=!0;function o(e,t){return e.w(' selected="true"')}o.__dustBody=!0;function c(e,t){return e.f(t.getPath(!0,[]),t,"h")}c.__dustBody=!0;function i(e,t){return e.f(t.get(["scale"],!1),t,"h")}i.__dustBody=!0;function l(e,t){return e.f(t.getPath(!0,[]),t,"h")}l.__dustBody=!0;return t};e.render=function(e){var t=this;if(t.map){!t.scales&&t.map.options.resolutions&&(t.scales=t.map.options.resolutions.map(t.getScale,t));var n=function(){t.scales=t.map.wrap.getResolutions().map(t.getScale,t);$("input[type=button]",t._$div).off();$("select",t._$div).off();t.renderData({scale:t.getScale(),screenSize:TC.Cfg.screenSize,scales:t.scales},function(){t._$div.find("option").each(function(e,n){$elm=$(n);$elm.text("1:"+t.format($elm.text().substr(2)))});t._$div.find('input[type="button"]').on(TC.Consts.event.CLICK,function(){t.setScreenSize.call(t)});$("select",t._$div).on("change",function(){t.setScale($(this).val())});$.isFunction(e)&&e()})};t.scales?n():$.when(t.map.wrap.getMap()).then(n)}};e.setScale=function(e){var t=.0254*e/this.getDpi(TC.Cfg.screenSize);window.devicePixelRatio&&(t/=window.devicePixelRatio);this.metersPerDegree&&(t/=this.metersPerDegree);this.map.wrap.setResolution(t);return t}}();