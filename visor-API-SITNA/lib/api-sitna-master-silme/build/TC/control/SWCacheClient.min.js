TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.SWCacheClient=function(){this.serviceWorkerEnabled=!1;this._serviceWorkerDeferred=$.Deferred()};TC.inherit(TC.control.SWCacheClient,TC.Control);var e=TC.control.SWCacheClient.prototype;e.CLASS="tc-ctl-swcc";e.register=function(e){var r=this;TC.Control.prototype.register.call(r,e);navigator.serviceWorker?navigator.serviceWorker.register("tc-cb-service-worker.js",{scope:"./"}).then(function(e){r.serviceWorkerEnabled=!0;e.installing?r._serviceWorkerDeferred.resolve(e.installing):e.waiting?r._serviceWorkerDeferred.resolve(e.waiting):e.active&&r._serviceWorkerDeferred.resolve(e.active);console.log(e.scope,"register")},function(e){r.serviceWorkerEnabled=!1;r._serviceWorkerDeferred.reject();console.error("Could not register service worker: "+e)}):r._serviceWorkerDeferred.reject()};e.getServiceWorker=function(){return this._serviceWorkerDeferred.promise()};var r=function(e,r,t,o){navigator.serviceWorker.addEventListener("message",function n(i){if(i.data.name===r){i.data.action===t&&i.data.event===o?e.resolve(r):"error"===i.data.event&&e.reject();navigator.serviceWorker.removeEventListener("message",n)}})};e.createCache=function(e,t){var o=$.Deferred();this.getServiceWorker().then(function(n){var i=t||{};r(o,e,"create","cached");n.postMessage({action:"create",name:e,list:i.urlList||[],silent:i.silent})},function(){o.resolve(!1)});return o.promise()};e.deleteCache=function(e,t){var o=$.Deferred();this.getServiceWorker().then(function(n){var i=t||{};r(o,e,"delete","deleted");n.postMessage({action:"delete",name:e,silent:i.silent})},function(){o.resolve(!1)});return o.promise()}}();