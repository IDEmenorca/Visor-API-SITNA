TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.ProjectionSelector=function(){const s=this;TC.Control.apply(s,arguments);s._cssClasses={LOAD_CRS_BUTTON:s.CLASS+"-crs-btn-load",CRS_DIALOG:s.CLASS+"-crs-dialog",CRS_LIST:s.CLASS+"-crs-list",CURRENT_CRS_NAME:s.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:s.CLASS+"-cur-crs-code",CHANGE:s.CLASS+"-change",NO_CHANGE:s.CLASS+"-no-change"};s._$dialogDiv=$(TC.Util.getDiv(s.options.dialogDiv));s.options.dialogDiv||s._$dialogDiv.appendTo("body");s._$dialogDiv.on(TC.Consts.event.CLICK,"button",function(t){const n=$(t.target).data(o.PROJCODE);n&&s.setProjection({crs:n,allowFallbackLayer:!0})}).on(TC.Consts.event.CLICK,"button."+s._cssClasses.LOAD_CRS_BUTTON,function(o){s.loadFallbackProjections()})};TC.inherit(TC.control.ProjectionSelector,TC.Control);const s=TC.control.ProjectionSelector.prototype;s.CLASS="tc-ctl-projs";const o={LAYER:"tcLayer",FALLBACK_LAYER:"tcFallbackLayer",PROJCODE:"tcProjCode"};s.render=function(s){const o=this;TC.Control.prototype.render.call(o,s);o.getRenderedHtml(o.CLASS+"-dialog",null,function(s){o._$dialogDiv.html(s)})};s.getAvailableCRS=function(s){return this.map.getCompatibleCRS({includeFallbacks:!0})};s.showProjectionChangeDialog=function(s){const t=this,n=t._$dialogDiv.find("."+t._cssClasses.CRS_DIALOG),e=n.find(".tc-modal-body").addClass(TC.Consts.classes.LOADING),l=e.find("ul."+t._cssClasses.CRS_LIST).empty(),a=t.map.baseLayer.firstOption||t.map.baseLayer,C=a.getFallbackLayer(),i=a.getCompatibleCRS(),c=function(){t.map.loadProjections({crsList:t.getAvailableCRS(s),orderBy:"name"}).then(function(s){var a=!1;s.forEach(function(s){if(TC.Util.CRSCodesEqual(t.map.crs,s.code)){n.find("."+t._cssClasses.CURRENT_CRS_NAME).html(s.name);n.find("."+t._cssClasses.CURRENT_CRS_CODE).html(s.code)}else{const t=$("<button>").html(s.name+" ("+s.code+")").data(o.PROJCODE,s.code),n=$("<li>").append(t);if(0===i.filter(function(o){return TC.Util.CRSCodesEqual(o,s.code)}).length){a=!0;n.addClass(TC.Consts.classes.HIDDEN);t.addClass(TC.Consts.classes.WARNING)}l.append(n)}});a&&l.append($("<li>").append($("<button>").addClass(t._cssClasses.LOAD_CRS_BUTTON).html(t.getLocaleString("showOnTheFlyProjections"))));0===l.find("li").length&&l.append($("<li>").append(t.getLocaleString("thereAreNoCompatibleCRS")));const C=l.find("li").not("."+TC.Consts.classes.HIDDEN);n.find("."+t._cssClasses.CHANGE).css("display",C.length>1?"":"none");n.find("."+t._cssClasses.NO_CHANGE).css("display",C.length>1?"none":"");n.find("ul."+t._cssClasses.CRS_LIST).css("display",C.length>0||a?"":"none");e.removeClass(TC.Consts.classes.LOADING)})};C?C.getCapabilitiesPromise().then(c):c();TC.Util.showModal(n,s)};s.setProjection=function(s){const o=this;s=s||{};TC.loadProjDef({crs:s.crs,callback:function(){o.map.setProjection(s)}})};s.loadFallbackProjections=function(){const s=this._$dialogDiv.find("."+this._cssClasses.CRS_DIALOG).find("ul."+this._cssClasses.CRS_LIST+" li").removeClass(TC.Consts.classes.HIDDEN);s.has("button."+this._cssClasses.LOAD_CRS_BUTTON).addClass(TC.Consts.classes.HIDDEN);this._$dialogDiv.find("p."+TC.Consts.classes.WARNING).removeClass(TC.Consts.classes.HIDDEN);this._$dialogDiv.find("."+this._cssClasses.CHANGE).css("display",s.length>1?"":"none");this._$dialogDiv.find("."+this._cssClasses.NO_CHANGE).css("display",s.length>1?"none":"")}}();