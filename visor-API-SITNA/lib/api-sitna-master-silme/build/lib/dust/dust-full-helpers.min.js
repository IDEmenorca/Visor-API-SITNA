!function(n,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.core",[],t):"object"==typeof exports?module.exports=t():n.dust=t()}(this,function(){function c(t,i){if(t)return"function"==typeof t&&t.template?t.template:n.isTemplateFn(t)?t:i!==!1?n.cache[t]:void 0}function o(t,r,u){if(!t)return r.setError(new Error("No template or template name provided to render"));var f=c(t,n.config.cache);return f?f(r,i.wrap(u,f.templateName)):n.onLoad?r.map(function(r){function e(t,e){var o;if(t)return r.setError(t);if(o=c(e,!1)||c(f,n.config.cache),!o){if(!n.compile)return r.setError(new Error("Dust compiler not available"));o=n.loadSource(n.compile(e,f))}o(r,i.wrap(u,o.templateName)).end()}var f=t;3===n.onLoad.length?n.onLoad(f,u.options,e):n.onLoad(f,e)}):r.setError(new Error("Template Not Found: "+t))}function i(n,t,i,r,u){void 0===n||n instanceof l||(n=new l(n));this.stack=n;this.global=t;this.options=i;this.blocks=r;this.templateName=u}function k(n,t,i){return function(r){return n.push(r)._get(t,i)}}function l(n,t,i,r){this.tail=t;this.isObject=n&&"object"==typeof n;this.head=n;this.index=i;this.of=r}function a(n){this.head=new t(this);this.callback=n;this.out=""}function e(){this.head=new t(this)}function t(n,t,i){this.root=n;this.next=t;this.data=[];this.flushable=!1;this.taps=i}function s(n,t){this.head=n;this.tail=t}var n={version:"2.7.1"},d="NONE",r="ERROR",u="WARN",v="INFO",f="DEBUG",y=function(){},h;n.config={whitespace:!1,amd:!1,cjs:!1,cache:!0};n._aliases={write:"w",end:"e",map:"m",render:"r",reference:"f",section:"s",exists:"x",notexists:"nx",block:"b",partial:"p",helper:"h"},function(){var t,i,r={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4};"undefined"!=typeof console&&console.log?(t=console.log,i="function"==typeof t?function(){t.apply(console,arguments)}:function(){t(Array.prototype.slice.apply(arguments).join(" "))}):i=y;n.log=function(t,u){u=u||v;r[u]>=r[n.debugLevel]&&i("[DUST:"+u+"]",t)};n.debugLevel=d;"undefined"!=typeof process&&process.env&&/\bdust\b/.test(process.env.DEBUG)&&(n.debugLevel=f)}();n.helpers={};n.cache={};n.register=function(t,i){t&&(i.templateName=t,n.config.cache!==!1&&(n.cache[t]=i))};n.render=function(n,t,i){var r=new a(i).head;try{o(n,r,t).end()}catch(u){r.setError(u)}};n.stream=function(t,i){var r=new e,u=r.head;return n.nextTick(function(){try{o(t,u,i).end()}catch(n){u.setError(n)}}),r};n.loadSource=function(source){return eval(source)};n.isArray=Array.isArray?Array.isArray:function(n){return"[object Array]"===Object.prototype.toString.call(n)};n.nextTick=function(){return function(n){setTimeout(n,0)}}();n.isEmpty=function(t){return 0===t?!1:n.isArray(t)&&!t.length?!0:!t};n.isEmptyObject=function(n){var t;if(null===n||void 0===n||n.length>0)return!1;for(t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0};n.isTemplateFn=function(n){return"function"==typeof n&&n.__dustBody};n.isThenable=function(n){return n&&"object"==typeof n&&"function"==typeof n.then};n.isStreamable=function(n){return n&&"function"==typeof n.on};n.filter=function(t,i,r){var e,o,f;if(r)for(e=0,o=r.length;o>e;e++)f=r[e],"s"===f?i=null:"function"==typeof n.filters[f]?t=n.filters[f](t):n.log("Invalid filter `"+f+"`",u);return i&&(t=n.filters[i](t)),t};n.filters={h:function(t){return n.escapeHtml(t)},j:function(t){return n.escapeJs(t)},u:encodeURI,uc:encodeURIComponent,js:function(t){return n.escapeJSON(t)},jp:function(t){return JSON?JSON.parse(t):(n.log("JSON is undefined; could not parse `"+t+"`",u),t)}};n.makeBase=n.context=function(n,t){return new i(void 0,n,t)};i.wrap=function(n,t){return n instanceof i?n:new i(n,{},{},null,t)};i.prototype.get=function(n,t){return"string"==typeof n&&("."===n[0]&&(t=!0,n=n.substr(1)),n=n.split(".")),this._get(t,n)};i.prototype._get=function(t,i){var f,e,h,o,c,u=this.stack||{},s=1;if(e=i[0],h=i.length,t&&0===h)o=u,u=u.head;else{if(t)u&&(u=u.head?u.head[e]:void 0);else{for(;u&&(!u.isObject||(o=u.head,f=u.head[e],void 0===f));)u=u.tail;u=void 0!==f?f:this.global&&this.global[e]}for(;u&&h>s;){if(n.isThenable(u))return u.then(k(this,t,i.slice(s)));o=u;u=u[i[s]];s++}}return"function"==typeof u?(c=function(){try{return u.apply(o,arguments)}catch(t){throw n.log(t,r),t;}},c.__dustBody=!!u.__dustBody,c):(void 0===u&&n.log("Cannot find reference `{"+i.join(".")+"}` in template `"+this.getTemplateName()+"`",v),u)};i.prototype.getPath=function(n,t){return this._get(n,t)};i.prototype.push=function(t,i,r){return void 0===t?(n.log("Not pushing an undefined variable onto the context",v),this):this.rebase(new l(t,this.stack,i,r))};i.prototype.pop=function(){var n=this.current();return this.stack=this.stack&&this.stack.tail,n};i.prototype.rebase=function(n){return new i(n,this.global,this.options,this.blocks,this.getTemplateName())};i.prototype.clone=function(){var n=this.rebase();return n.stack=this.stack,n};i.prototype.current=function(){return this.stack&&this.stack.head};i.prototype.getBlock=function(i){var r,u,e;if("function"==typeof i&&(i=i(new t,this).data.join("")),r=this.blocks,!r)return n.log("No blocks for context `"+i+"` in template `"+this.getTemplateName()+"`",f),!1;for(u=r.length;u--;)if(e=r[u][i])return e;return n.log("Malformed template `"+this.getTemplateName()+"` was missing one or more blocks."),!1};i.prototype.shiftBlocks=function(n){var t,r=this.blocks;return n?(t=r?r.concat([n]):[n],new i(this.stack,this.global,this.options,t,this.getTemplateName())):this};i.prototype.resolve=function(n){var i;return"function"!=typeof n?n:(i=(new t).render(n,this),i instanceof t?i.data.join(""):i)};i.prototype.getTemplateName=function(){return this.templateName};a.prototype.flush=function(){for(var t=this.head;t;){if(!t.flushable)return t.error?(this.callback(t.error),n.log("Rendering failed with error `"+t.error+"`",r),void(this.flush=y)):void 0;this.out+=t.data.join("");t=t.next;this.head=t}this.callback(null,this.out)};e.prototype.flush=function(){for(var t=this.head;t;){if(!t.flushable)return t.error?(this.emit("error",t.error),this.emit("end"),n.log("Streaming failed with error `"+t.error+"`",r),void(this.flush=y)):void 0;this.emit("data",t.data.join(""));t=t.next;this.head=t}this.emit("end")};e.prototype.emit=function(t,i){var u,e,o=this.events||{},r=o[t]||[];if(!r.length)return n.log("Stream broadcasting, but no listeners for `"+t+"`",f),!1;for(r=r.slice(0),u=0,e=r.length;e>u;u++)r[u](i);return!0};e.prototype.on=function(t,i){var r=this.events=this.events||{},f=r[t]=r[t]||[];return"function"!=typeof i?n.log("No callback function provided for `"+t+"` event listener",u):f.push(i),this};e.prototype.pipe=function(t){if("function"!=typeof t.write||"function"!=typeof t.end)return n.log("Incompatible stream passed to `pipe`",u),this;var i=!1;return"function"==typeof t.emit&&t.emit("pipe",this),"function"==typeof t.on&&t.on("error",function(){i=!0}),this.on("data",function(u){if(!i)try{t.write(u,"utf8")}catch(f){n.log(f,r)}}).on("end",function(){if(!i)try{t.end();i=!0}catch(u){n.log(u,r)}})};t.prototype.write=function(n){var t=this.taps;return t&&(n=t.go(n)),this.data.push(n),this};t.prototype.end=function(n){return n&&this.write(n),this.flushable=!0,this.root.flush(),this};t.prototype.map=function(i){var f=new t(this.root,this.next,this.taps),u=new t(this.root,f,this.taps);this.next=u;this.flushable=!0;try{i(u)}catch(e){n.log(e,r);u.setError(e)}return f};t.prototype.tap=function(n){var t=this.taps;return this.taps=t?t.push(n):new s(n),this};t.prototype.untap=function(){return this.taps=this.taps.tail,this};t.prototype.render=function(n,t){return n(this,t)};t.prototype.reference=function(i,r,u,f){return"function"==typeof i?(i=i.apply(r.current(),[this,r,null,{auto:u,filters:f}]),i instanceof t?i:this.reference(i,r,u,f)):n.isThenable(i)?this.await(i,r,null,u,f):n.isStreamable(i)?this.stream(i,r,null,u,f):n.isEmpty(i)?this:this.write(n.filter(i,u,f))};t.prototype.section=function(i,u,e,o){var s,c,l,h=e.block,a=e["else"],v=this;if("function"==typeof i&&!n.isTemplateFn(i)){try{i=i.apply(u.current(),[this,u,e,o])}catch(y){return n.log(y,r),this.setError(y)}if(i instanceof t)return i}if(n.isEmptyObject(o)||(u=u.push(o)),n.isArray(i)){if(h){if(c=i.length,c>0){for(l=u.stack&&u.stack.head||{},l.$len=c,s=0;c>s;s++)l.$idx=s,v=h(v,u.push(i[s],s,c));return l.$idx=void 0,l.$len=void 0,v}if(a)return a(this,u)}}else{if(n.isThenable(i))return this.await(i,u,e);if(n.isStreamable(i))return this.stream(i,u,e);if(i===!0){if(h)return h(this,u)}else if(i||0===i){if(h)return h(this,u.push(i))}else if(a)return a(this,u)}return n.log("Section without corresponding key in template `"+u.getTemplateName()+"`",f),this};t.prototype.exists=function(t,i,r){var u=r.block,e=r["else"];if(n.isEmpty(t)){if(e)return e(this,i)}else{if(u)return u(this,i);n.log("No block for exists check in template `"+i.getTemplateName()+"`",f)}return this};t.prototype.notexists=function(t,i,r){var u=r.block,e=r["else"];if(n.isEmpty(t)){if(u)return u(this,i);n.log("No block for not-exists check in template `"+i.getTemplateName()+"`",f)}else if(e)return e(this,i);return this};t.prototype.block=function(n,t,i){var r=n||i.block;return r?r(this,t):this};t.prototype.partial=function(t,i,r,u){var f;return void 0===u&&(u=r,r=i),n.isEmptyObject(u)||(r=r.clone(),f=r.pop(),r=r.push(u).push(f)),n.isTemplateFn(t)?this.capture(t,i,function(n,t){r.templateName=n;o(n,t,r).end()}):(r.templateName=t,o(t,this,r))};t.prototype.helper=function(t,i,f,e){var o,s=this;if(!n.helpers[t])return n.log("Helper `"+t+"` does not exist",u),s;try{return o=n.helpers[t](s,i,f,e),n.isThenable(o)?this.await(o,i,f):o}catch(h){return n.log("Error in helper `"+t+"`: "+h.message,r),s.setError(h)}};t.prototype.await=function(t,i,r,u,f){var e=r&&r.block,o=r&&r.error;return this.map(function(r){t.then(function(n){e?r.render(e,i.push(n)).end():r.reference(n,i,u,f).end()},function(t){o?r.render(o,i.push(t)).end():(n.log("Unhandled promise rejection in `"+i.getTemplateName()+"`"),r.end())})})};t.prototype.stream=function(t,i,r,u,f){var e=r&&r.block,o=r&&r.error;return this.map(function(r){var s=!1;t.on("data",function(n){s||(r=e?r.map(function(t){t.render(e,i.push(n)).end()}):r.reference(n,i,u,f))}).on("error",function(t){s||(o?r.render(o,i.push(t)):n.log("Unhandled stream error in `"+i.getTemplateName()+"`"),s||(s=!0,r.end()))}).on("end",function(){s||(s=!0,r.end())})})};t.prototype.capture=function(n,t,i){return this.map(function(r){var u=new a(function(n,t){n?r.setError(n):i(t,r)});n(u.head,t).end()})};t.prototype.setError=function(n){return this.error=n,this.root.flush(),this};for(h in t.prototype)n._aliases[h]&&(t.prototype[n._aliases[h]]=t.prototype[h]);s.prototype.push=function(n){return new s(n,this)};s.prototype.go=function(n){for(var t=this;t;)n=t.head(n),t=t.tail;return n};var g=/[&<>"']/,nt=/&/g,p=/</g,tt=/>/g,it=/\"/g,rt=/\'/g;n.escapeHtml=function(n){return"string"==typeof n||n&&"function"==typeof n.toString?("string"!=typeof n&&(n=n.toString()),g.test(n)?n.replace(nt,"&amp;").replace(p,"&lt;").replace(tt,"&gt;").replace(it,"&quot;").replace(rt,"&#39;"):n):n};var ut=/\\/g,ft=/\//g,et=/\r/g,w=/\u2028/g,b=/\u2029/g,ot=/\n/g,st=/\f/g,ht=/'/g,ct=/"/g,lt=/\t/g;return n.escapeJs=function(n){return"string"==typeof n?n.replace(ut,"\\\\").replace(ft,"\\/").replace(ct,'\\"').replace(ht,"\\'").replace(et,"\\r").replace(w,"\\u2028").replace(b,"\\u2029").replace(ot,"\\n").replace(st,"\\f").replace(lt,"\\t"):n},n.escapeJSON=function(t){return JSON?JSON.stringify(t).replace(w,"\\u2028").replace(b,"\\u2029").replace(p,"\\u003c"):(n.log("JSON is undefined; could not escape `"+t+"`",u),t)},n}),function(n,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.parse",["dust.core"],function(n){return t(n).parse}):"object"==typeof exports?module.exports=t(require("./dust")):t(n.dust)}(this,function(n){var t=function(){function t(n,t){function i(){this.constructor=n}i.prototype=t.prototype;n.prototype=new i}function n(n,t,i,r,u,f){this.message=n;this.expected=t;this.found=i;this.offset=r;this.line=u;this.column=f;this.name="SyntaxError"}function i(t){function wr(){return pt(o).line}function br(){return pt(o).column}function kr(n){throw hi(n,null,o);}function pt(n){function i(n,i,r){for(var u,f=i;r>f;f++)u=t.charAt(f),"\n"===u?(n.seenCR||n.line++,n.column=1,n.seenCR=!1):"\r"===u||"\u2028"===u||"\u2029"===u?(n.line++,n.column=1,n.seenCR=!0):(n.column++,n.seenCR=!1)}return ut!==n&&(ut>n&&(ut=0,oi={line:1,column:1,seenCR:!1}),i(oi,ut,n),ut=n),oi}function e(n){yt>i||(i>yt&&(yt=i,si=[]),si.push(n))}function hi(i,r,u){function o(n){var t=1;for(n.sort(function(n,t){return n.description<t.description?-1:n.description>t.description?1:0});t<n.length;)n[t-1]===n[t]?n.splice(t,1):t++}function s(n,t){function e(n){function t(n){return n.charCodeAt(0).toString(16).toUpperCase()}return n.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(n){return"\\x0"+t(n)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(n){return"\\x"+t(n)}).replace(/[\u0180-\u0FFF]/g,function(n){return"\\u0"+t(n)}).replace(/[\u1080-\uFFFF]/g,function(n){return"\\u"+t(n)})}for(var u,f,r=new Array(n.length),i=0;i<n.length;i++)r[i]=n[i].description;return u=n.length>1?r.slice(0,-1).join(", ")+" or "+r[n.length-1]:r[0],f=t?'"'+e(t)+'"':"end of input","Expected "+u+" but "+f+" found."}var f=pt(u),e=u<t.length?t.charAt(u):null;return null!==r&&o(r),new n(null!==i?i:s(r,e),r,e,u,f.line,f.column)}function ci(){return ft()}function ft(){var u,n,t;for(u=i,n=[],t=li();t!==r;)n.push(t),t=li();return n!==r&&(o=u,n=cu(n)),u=n}function li(){var n;return n=dt(),n===r&&(n=gt(),n===r&&(n=dr(),n===r&&(n=tu(),n===r&&(n=pi(),n===r&&(n=wt(),n===r&&(n=eu())))))),n}function dr(){var n,l,v,c,y,w,p,b;if(u++,n=i,l=ai(),l!==r){for(v=[],c=s();c!==r;)v.push(c),c=s();v!==r?(c=a(),c!==r?(y=ft(),y!==r?(w=nu(),w!==r?(p=gr(),p===r&&(p=rt),p!==r?(o=i,b=au(l,y,w,p),b=b?h:f,b!==r?(o=n,l=vu(l,y,w,p),n=l):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)}else i=n,n=f;if(n===r)if(n=i,l=ai(),l!==r){for(v=[],c=s();c!==r;)v.push(c),c=s();v!==r?(47===t.charCodeAt(i)?(c=ni,i++):(c=r,0===u&&e(ti)),c!==r?(y=a(),y!==r?(o=n,l=yu(l),n=l):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)}else i=n,n=f;return u--,n===r&&(l=r,0===u&&e(lu)),n}function ai(){var n,c,l,a,h,y,w;if(n=i,c=v(),c!==r)if(pu.test(t.charAt(i))?(l=t.charAt(i),i++):(l=r,0===u&&e(wu)),l!==r){for(a=[],h=s();h!==r;)a.push(h),h=s();a!==r?(h=p(),h!==r?(y=vi(),y!==r?(w=yi(),w!==r?(o=n,c=bu(l,h,y,w),n=c):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)}else i=n,n=f;else i=n,n=f;return n}function gr(){var n,l,y,w,h,b,c;if(u++,n=i,l=v(),l!==r)if(47===t.charCodeAt(i)?(y=ni,i++):(y=r,0===u&&e(ti)),y!==r){for(w=[],h=s();h!==r;)w.push(h),h=s();if(w!==r)if(h=p(),h!==r){for(b=[],c=s();c!==r;)b.push(c),c=s();b!==r?(c=a(),c!==r?(o=n,l=du(h),n=l):(i=n,n=f)):(i=n,n=f)}else i=n,n=f;else i=n,n=f}else i=n,n=f;else i=n,n=f;return u--,n===r&&(l=r,0===u&&e(ku)),n}function vi(){var h,n,s,c;return h=i,n=i,58===t.charCodeAt(i)?(s=ii,i++):(s=r,0===u&&e(ri)),s!==r?(c=p(),c!==r?(o=n,s=ui(c),n=s):(i=n,n=f)):(i=n,n=f),n===r&&(n=rt),n!==r&&(o=h,n=gu(n)),h=n}function yi(){var w,v,n,a,h,y,c;if(u++,w=i,v=[],n=i,a=[],h=s(),h!==r)for(;h!==r;)a.push(h),h=s();else a=f;for(a!==r?(h=l(),h!==r?(61===t.charCodeAt(i)?(y=ir,i++):(y=r,0===u&&e(rr)),y!==r?(c=wi(),c===r&&(c=p(),c===r&&(c=kt())),c!==r?(o=n,a=ht(h,c),n=a):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)):(i=n,n=f);n!==r;){if(v.push(n),n=i,a=[],h=s(),h!==r)for(;h!==r;)a.push(h),h=s();else a=f;a!==r?(h=l(),h!==r?(61===t.charCodeAt(i)?(y=ir,i++):(y=r,0===u&&e(rr)),y!==r?(c=wi(),c===r&&(c=p(),c===r&&(c=kt())),c!==r?(o=n,a=ht(h,c),n=a):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)}return v!==r&&(o=w,v=tf(v)),w=v,u--,w===r&&(v=r,0===u&&e(nf)),w}function nu(){var w,h,n,s,c,y,b,p;for(u++,w=i,h=[],n=i,s=v(),s!==r?(58===t.charCodeAt(i)?(c=ii,i++):(c=r,0===u&&e(ri)),c!==r?(y=l(),y!==r?(b=a(),b!==r?(p=ft(),p!==r?(o=n,s=ht(y,p),n=s):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)):(i=n,n=f);n!==r;)h.push(n),n=i,s=v(),s!==r?(58===t.charCodeAt(i)?(c=ii,i++):(c=r,0===u&&e(ri)),c!==r?(y=l(),y!==r?(b=a(),b!==r?(p=ft(),p!==r?(o=n,s=ht(y,p),n=s):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)):(i=n,n=f);return h!==r&&(o=w,h=uf(h)),w=h,u--,w===r&&(h=r,0===u&&e(rf)),w}function wt(){var n,t,s,h,c;return u++,n=i,t=v(),t!==r?(s=p(),s!==r?(h=iu(),h!==r?(c=a(),c!==r?(o=n,t=ef(s,h),n=t):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)):(i=n,n=f),u--,n===r&&(t=r,0===u&&e(ff)),n}function tu(){var n,w,y,b,h,c,k,d,p,g;if(u++,n=i,w=v(),w!==r)if(62===t.charCodeAt(i)?(y=sf,i++):(y=r,0===u&&e(hf)),y===r&&(43===t.charCodeAt(i)?(y=cf,i++):(y=r,0===u&&e(lf))),y!==r){for(b=[],h=s();h!==r;)b.push(h),h=s();if(b!==r)if(h=i,c=l(),c!==r&&(o=h,c=af(c)),h=c,h===r&&(h=kt()),h!==r)if(c=vi(),c!==r)if(k=yi(),k!==r){for(d=[],p=s();p!==r;)d.push(p),p=s();d!==r?(47===t.charCodeAt(i)?(p=ni,i++):(p=r,0===u&&e(ti)),p!==r?(g=a(),g!==r?(o=n,w=vf(y,h,c,k),n=w):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)}else i=n,n=f;else i=n,n=f;else i=n,n=f;else i=n,n=f}else i=n,n=f;else i=n,n=f;return u--,n===r&&(w=r,0===u&&e(of)),n}function iu(){var a,h,n,s,c;for(u++,a=i,h=[],n=i,124===t.charCodeAt(i)?(s=ur,i++):(s=r,0===u&&e(fr)),s!==r?(c=l(),c!==r?(o=n,s=ui(c),n=s):(i=n,n=f)):(i=n,n=f);n!==r;)h.push(n),n=i,124===t.charCodeAt(i)?(s=ur,i++):(s=r,0===u&&e(fr)),s!==r?(c=l(),c!==r?(o=n,s=ui(c),n=s):(i=n,n=f)):(i=n,n=f);return h!==r&&(o=a,h=pf(h)),a=h,u--,a===r&&(h=r,0===u&&e(yf)),a}function pi(){var n,s,h,c,y;return u++,n=i,s=v(),s!==r?(126===t.charCodeAt(i)?(h=bf,i++):(h=r,0===u&&e(kf)),h!==r?(c=l(),c!==r?(y=a(),y!==r?(o=n,s=df(c),n=s):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)):(i=n,n=f),u--,n===r&&(s=r,0===u&&e(wf)),n}function p(){var t,n;return u++,t=i,n=fu(),n!==r&&(o=t,n=ne(n)),t=n,t===r&&(t=i,n=l(),n!==r&&(o=t,n=te(n)),t=n),u--,t===r&&(n=r,0===u&&e(gf)),t}function wi(){var t,n;return u++,t=i,n=ru(),n===r&&(n=bi()),n!==r&&(o=t,n=re(n)),t=n,u--,t===r&&(n=r,0===u&&e(ie)),t}function ru(){var n,s,h,c;return u++,n=i,s=bi(),s!==r?(46===t.charCodeAt(i)?(h=ct,i++):(h=r,0===u&&e(lt)),h!==r?(c=bt(),c!==r?(o=n,s=fe(s,c),n=s):(i=n,n=f)):(i=n,n=f)):(i=n,n=f),u--,n===r&&(s=r,0===u&&e(ue)),n}function bt(){var h,n,s;if(u++,h=i,n=[],at.test(t.charAt(i))?(s=t.charAt(i),i++):(s=r,0===u&&e(vt)),s!==r)for(;s!==r;)n.push(s),at.test(t.charAt(i))?(s=t.charAt(i),i++):(s=r,0===u&&e(vt));else n=f;return n!==r&&(o=h,n=oe(n)),h=n,u--,h===r&&(n=r,0===u&&e(ee)),h}function uu(){var n,s,h;return u++,n=i,45===t.charCodeAt(i)?(s=he,i++):(s=r,0===u&&e(ce)),s!==r?(h=bt(),h!==r?(o=n,s=le(s,h),n=s):(i=n,n=f)):(i=n,n=f),u--,n===r&&(s=r,0===u&&e(se)),n}function bi(){var n,t;return u++,n=uu(),n===r&&(n=bt()),u--,n===r&&(t=r,0===u&&e(ae)),n}function fu(){var n,h,c,s;if(u++,n=i,h=l(),h===r&&(h=rt),h!==r){if(c=[],s=it(),s===r&&(s=tt()),s!==r)for(;s!==r;)c.push(s),s=it(),s===r&&(s=tt());else c=f;c!==r?(o=n,h=ye(h,c),n=h):(i=n,n=f)}else i=n,n=f;if(n===r)if(n=i,46===t.charCodeAt(i)?(h=ct,i++):(h=r,0===u&&e(lt)),h!==r){for(c=[],s=it(),s===r&&(s=tt());s!==r;)c.push(s),s=it(),s===r&&(s=tt());c!==r?(o=n,h=pe(c),n=h):(i=n,n=f)}else i=n,n=f;return u--,n===r&&(h=r,0===u&&e(ve)),n}function l(){var n,s,c,h;if(u++,n=i,be.test(t.charAt(i))?(s=t.charAt(i),i++):(s=r,0===u&&e(ke)),s!==r){for(c=[],er.test(t.charAt(i))?(h=t.charAt(i),i++):(h=r,0===u&&e(or));h!==r;)c.push(h),er.test(t.charAt(i))?(h=t.charAt(i),i++):(h=r,0===u&&e(or));c!==r?(o=n,s=de(s,c),n=s):(i=n,n=f)}else i=n,n=f;return u--,n===r&&(s=r,0===u&&e(we)),n}function tt(){var s,n,h,l,c,a;if(u++,s=i,n=i,h=ou(),h!==r){if(l=i,c=[],at.test(t.charAt(i))?(a=t.charAt(i),i++):(a=r,0===u&&e(vt)),a!==r)for(;a!==r;)c.push(a),at.test(t.charAt(i))?(a=t.charAt(i),i++):(a=r,0===u&&e(vt));else c=f;c!==r&&(o=l,c=no(c));l=c;l===r&&(l=p());l!==r?(c=su(),c!==r?(o=n,h=to(l),n=h):(i=n,n=f)):(i=n,n=f)}else i=n,n=f;return n!==r?(h=it(),h===r&&(h=rt),h!==r?(o=s,n=io(n,h),s=n):(i=s,s=f)):(i=s,s=f),u--,s===r&&(n=r,0===u&&e(ge)),s}function it(){var h,c,n,s,a;if(u++,h=i,c=[],n=i,46===t.charCodeAt(i)?(s=ct,i++):(s=r,0===u&&e(lt)),s!==r?(a=l(),a!==r?(o=n,s=sr(a),n=s):(i=n,n=f)):(i=n,n=f),n!==r)for(;n!==r;)c.push(n),n=i,46===t.charCodeAt(i)?(s=ct,i++):(s=r,0===u&&e(lt)),s!==r?(a=l(),a!==r?(o=n,s=sr(a),n=s):(i=n,n=f)):(i=n,n=f);else c=f;return c!==r?(n=tt(),n===r&&(n=rt),n!==r?(o=h,c=uo(c,n),h=c):(i=h,h=f)):(i=h,h=f),u--,h===r&&(c=r,0===u&&e(ro)),h}function kt(){var n,s,h,c;if(u++,n=i,34===t.charCodeAt(i)?(s=b,i++):(s=r,0===u&&e(k)),s!==r?(34===t.charCodeAt(i)?(h=b,i++):(h=r,0===u&&e(k)),h!==r?(o=n,s=eo(),n=s):(i=n,n=f)):(i=n,n=f),n===r&&(n=i,34===t.charCodeAt(i)?(s=b,i++):(s=r,0===u&&e(k)),s!==r?(h=di(),h!==r?(34===t.charCodeAt(i)?(c=b,i++):(c=r,0===u&&e(k)),c!==r?(o=n,s=oo(h),n=s):(i=n,n=f)):(i=n,n=f)):(i=n,n=f),n===r))if(n=i,34===t.charCodeAt(i)?(s=b,i++):(s=r,0===u&&e(k)),s!==r){if(h=[],c=ki(),c!==r)for(;c!==r;)h.push(c),c=ki();else h=f;h!==r?(34===t.charCodeAt(i)?(c=b,i++):(c=r,0===u&&e(k)),c!==r?(o=n,s=so(h),n=s):(i=n,n=f)):(i=n,n=f)}else i=n,n=f;return u--,n===r&&(s=r,0===u&&e(fo)),n}function ki(){var n,t;return n=pi(),n===r&&(n=wt(),n===r&&(n=i,t=di(),t!==r&&(o=n,t=ho(t)),n=t)),n}function eu(){var p,b,n,c,l,a,v,k;if(u++,p=i,b=w(),b!==r){for(n=[],c=s();c!==r;)n.push(c),c=s();n!==r?(o=p,b=lo(b,n),p=b):(i=p,p=f)}else i=p,p=f;if(p===r){if(p=i,b=[],n=i,c=i,u++,l=et(),u--,l===r?c=h:(i=c,c=f),c!==r?(l=i,u++,a=dt(),u--,a===r?l=h:(i=l,l=f),l!==r?(a=i,u++,v=gt(),u--,v===r?a=h:(i=a,a=f),a!==r?(v=i,u++,k=w(),u--,k===r?v=h:(i=v,v=f),v!==r?(t.length>i?(k=t.charAt(i),i++):(k=r,0===u&&e(y)),k!==r?(o=n,c=d(k),n=c):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)):(i=n,n=f),n!==r)for(;n!==r;)b.push(n),n=i,c=i,u++,l=et(),u--,l===r?c=h:(i=c,c=f),c!==r?(l=i,u++,a=dt(),u--,a===r?l=h:(i=l,l=f),l!==r?(a=i,u++,v=gt(),u--,v===r?a=h:(i=a,a=f),a!==r?(v=i,u++,k=w(),u--,k===r?v=h:(i=v,v=f),v!==r?(t.length>i?(k=t.charAt(i),i++):(k=r,0===u&&e(y)),k!==r?(o=n,c=d(k),n=c):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)):(i=n,n=f)):(i=n,n=f);else b=f;b!==r&&(o=p,b=ao(b));p=b}return u--,p===r&&(b=r,0===u&&e(co)),p}function di(){var a,l,n,c,s;if(u++,a=i,l=[],n=i,c=i,u++,s=et(),u--,s===r?c=h:(i=c,c=f),c!==r?(s=gi(),s===r&&(hr.test(t.charAt(i))?(s=t.charAt(i),i++):(s=r,0===u&&e(cr))),s!==r?(o=n,c=d(s),n=c):(i=n,n=f)):(i=n,n=f),n!==r)for(;n!==r;)l.push(n),n=i,c=i,u++,s=et(),u--,s===r?c=h:(i=c,c=f),c!==r?(s=gi(),s===r&&(hr.test(t.charAt(i))?(s=t.charAt(i),i++):(s=r,0===u&&e(cr))),s!==r?(o=n,c=d(s),n=c):(i=n,n=f)):(i=n,n=f);else l=f;return l!==r&&(o=a,l=yo(l)),a=l,u--,a===r&&(l=r,0===u&&e(vo)),a}function gi(){var f,n;return f=i,t.substr(i,2)===lr?(n=lr,i+=2):(n=r,0===u&&e(po)),n!==r&&(o=f,n=wo()),f=n}function dt(){var l,a,v,n,s,c;if(u++,l=i,t.substr(i,2)===ar?(a=ar,i+=2):(a=r,0===u&&e(ko)),a!==r){for(v=[],n=i,s=i,u++,t.substr(i,2)===g?(c=g,i+=2):(c=r,0===u&&e(fi)),u--,c===r?s=h:(i=s,s=f),s!==r?(t.length>i?(c=t.charAt(i),i++):(c=r,0===u&&e(y)),c!==r?(o=n,s=vr(c),n=s):(i=n,n=f)):(i=n,n=f);n!==r;)v.push(n),n=i,s=i,u++,t.substr(i,2)===g?(c=g,i+=2):(c=r,0===u&&e(fi)),u--,c===r?s=h:(i=s,s=f),s!==r?(t.length>i?(c=t.charAt(i),i++):(c=r,0===u&&e(y)),c!==r?(o=n,s=vr(c),n=s):(i=n,n=f)):(i=n,n=f);v!==r?(t.substr(i,2)===g?(n=g,i+=2):(n=r,0===u&&e(fi)),n!==r?(o=l,a=go(v),l=a):(i=l,l=f)):(i=l,l=f)}else i=l,l=f;return u--,l===r&&(a=r,0===u&&e(bo)),l}function gt(){var l,a,v,n,s,c;if(u++,l=i,t.substr(i,2)===yr?(a=yr,i+=2):(a=r,0===u&&e(ts)),a!==r){for(v=[],n=i,s=i,u++,t.substr(i,2)===nt?(c=nt,i+=2):(c=r,0===u&&e(ei)),u--,c===r?s=h:(i=s,s=f),s!==r?(t.length>i?(c=t.charAt(i),i++):(c=r,0===u&&e(y)),c!==r?(o=n,s=d(c),n=s):(i=n,n=f)):(i=n,n=f);n!==r;)v.push(n),n=i,s=i,u++,t.substr(i,2)===nt?(c=nt,i+=2):(c=r,0===u&&e(ei)),u--,c===r?s=h:(i=s,s=f),s!==r?(t.length>i?(c=t.charAt(i),i++):(c=r,0===u&&e(y)),c!==r?(o=n,s=d(c),n=s):(i=n,n=f)):(i=n,n=f);v!==r?(t.substr(i,2)===nt?(n=nt,i+=2):(n=r,0===u&&e(ei)),n!==r?(o=l,a=is(v),l=a):(i=l,l=f)):(i=l,l=f)}else i=l,l=f;return u--,l===r&&(a=r,0===u&&e(ns)),l}function et(){var c,d,g,k,nt,b,n,o,l,p;if(c=i,d=v(),d!==r){for(g=[],k=s();k!==r;)g.push(k),k=s();if(g!==r)if(rs.test(t.charAt(i))?(k=t.charAt(i),i++):(k=r,0===u&&e(us)),k!==r){for(nt=[],b=s();b!==r;)nt.push(b),b=s();if(nt!==r){if(b=[],n=i,o=i,u++,l=a(),u--,l===r?o=h:(i=o,o=f),o!==r?(l=i,u++,p=w(),u--,p===r?l=h:(i=l,l=f),l!==r?(t.length>i?(p=t.charAt(i),i++):(p=r,0===u&&e(y)),p!==r?(o=[o,l,p],n=o):(i=n,n=f)):(i=n,n=f)):(i=n,n=f),n!==r)for(;n!==r;)b.push(n),n=i,o=i,u++,l=a(),u--,l===r?o=h:(i=o,o=f),o!==r?(l=i,u++,p=w(),u--,p===r?l=h:(i=l,l=f),l!==r?(t.length>i?(p=t.charAt(i),i++):(p=r,0===u&&e(y)),p!==r?(o=[o,l,p],n=o):(i=n,n=f)):(i=n,n=f)):(i=n,n=f);else b=f;if(b!==r){for(n=[],o=s();o!==r;)n.push(o),o=s();n!==r?(o=a(),o!==r?(d=[d,g,k,nt,b,n,o],c=d):(i=c,c=f)):(i=c,c=f)}else i=c,c=f}else i=c,c=f}else i=c,c=f;else i=c,c=f}else i=c,c=f;return c===r&&(c=wt()),c}function v(){var n;return 123===t.charCodeAt(i)?(n=fs,i++):(n=r,0===u&&e(es)),n}function a(){var n;return 125===t.charCodeAt(i)?(n=os,i++):(n=r,0===u&&e(ss)),n}function ou(){var n;return 91===t.charCodeAt(i)?(n=hs,i++):(n=r,0===u&&e(cs)),n}function su(){var n;return 93===t.charCodeAt(i)?(n=ls,i++):(n=r,0===u&&e(as)),n}function w(){var n;return 10===t.charCodeAt(i)?(n=vs,i++):(n=r,0===u&&e(ys)),n===r&&(t.substr(i,2)===pr?(n=pr,i+=2):(n=r,0===u&&e(ps)),n===r&&(13===t.charCodeAt(i)?(n=ws,i++):(n=r,0===u&&e(bs)),n===r&&(8232===t.charCodeAt(i)?(n=ks,i++):(n=r,0===u&&e(ds)),n===r&&(8233===t.charCodeAt(i)?(n=gs,i++):(n=r,0===u&&e(nh)))))),n}function s(){var n;return th.test(t.charAt(i))?(n=t.charAt(i),i++):(n=r,0===u&&e(ih)),n===r&&(n=w()),n}function hu(n){return parseInt(n.join(""),10)}function c(n){return n.concat([["line",wr()],["col",br()]])}var ot,st=arguments.length>1?arguments[1]:{},r={},nr={start:ci},tr=ci,cu=function(n){var t=["body"].concat(n);return c(t)},lu={type:"other",description:"section"},f=r,rt=null,au=function(n,t,i,r){return r&&n[1].text===r.text||kr("Expected end tag for "+n[1].text+" but it was not found."),!0},h=void 0,vu=function(n,t,i){return i.push(["param",["literal","block"],t]),n.push(i),c(n)},ni="/",ti={type:"literal",value:"/",description:'"/"'},yu=function(n){return n.push(["bodies"]),c(n)},pu=/^[#?\^<+@%]/,wu={type:"class",value:"[#?\\^<+@%]",description:"[#?\\^<+@%]"},bu=function(n,t,i,r){return[n,t,i,r]},ku={type:"other",description:"end tag"},du=function(n){return n},ii=":",ri={type:"literal",value:":",description:'":"'},ui=function(n){return n},gu=function(n){return n?["context",n]:["context"]},nf={type:"other",description:"params"},ir="=",rr={type:"literal",value:"=",description:'"="'},ht=function(n,t){return["param",["literal",n],t]},tf=function(n){return["params"].concat(n)},rf={type:"other",description:"bodies"},uf=function(n){return["bodies"].concat(n)},ff={type:"other",description:"reference"},ef=function(n,t){return c(["reference",n,t])},of={type:"other",description:"partial"},sf=">",hf={type:"literal",value:">",description:'">"'},cf="+",lf={type:"literal",value:"+",description:'"+"'},af=function(n){return["literal",n]},vf=function(n,t,i,r){var u=">"===n?"partial":n;return c([u,t,i,r])},yf={type:"other",description:"filters"},ur="|",fr={type:"literal",value:"|",description:'"|"'},pf=function(n){return["filters"].concat(n)},wf={type:"other",description:"special"},bf="~",kf={type:"literal",value:"~",description:'"~"'},df=function(n){return c(["special",n])},gf={type:"other",description:"identifier"},ne=function(n){var t=["path"].concat(n);return t.text=n[1].join(".").replace(/,line,\d+,col,\d+/g,""),t},te=function(n){var t=["key",n];return t.text=n,t},ie={type:"other",description:"number"},re=function(n){return["literal",n]},ue={type:"other",description:"float"},ct=".",lt={type:"literal",value:".",description:'"."'},fe=function(n,t){return parseFloat(n+"."+t)},ee={type:"other",description:"unsigned_integer"},at=/^[0-9]/,vt={type:"class",value:"[0-9]",description:"[0-9]"},oe=function(n){return hu(n)},se={type:"other",description:"signed_integer"},he="-",ce={type:"literal",value:"-",description:'"-"'},le=function(n,t){return-1*t},ae={type:"other",description:"integer"},ve={type:"other",description:"path"},ye=function(n,t){return t=t[0],n&&t?(t.unshift(n),c([!1,t])):c([!0,t])},pe=function(n){return c(n.length>0?[!0,n[0]]:[!0,[]])},we={type:"other",description:"key"},be=/^[a-zA-Z_$]/,ke={type:"class",value:"[a-zA-Z_$]",description:"[a-zA-Z_$]"},er=/^[0-9a-zA-Z_$\-]/,or={type:"class",value:"[0-9a-zA-Z_$\\-]",description:"[0-9a-zA-Z_$\\-]"},de=function(n,t){return n+t.join("")},ge={type:"other",description:"array"},no=function(n){return n.join("")},to=function(n){return n},io=function(n,t){return t?t.unshift(n):t=[n],t},ro={type:"other",description:"array_part"},sr=function(n){return n},uo=function(n,t){return t?n.concat(t):n},fo={type:"other",description:"inline"},b='"',k={type:"literal",value:'"',description:'"\\""'},eo=function(){return c(["literal",""])},oo=function(n){return c(["literal",n])},so=function(n){return c(["body"].concat(n))},ho=function(n){return["buffer",n]},co={type:"other",description:"buffer"},lo=function(n,t){return c(["format",n,t.join("")])},y={type:"any",description:"any character"},d=function(n){return n},ao=function(n){return c(["buffer",n.join("")])},vo={type:"other",description:"literal"},hr=/^[^"]/,cr={type:"class",value:'[^"]',description:'[^"]'},yo=function(n){return n.join("")},lr='\\"',po={type:"literal",value:'\\"',description:'"\\\\\\""'},wo=function(){return'"'},bo={type:"other",description:"raw"},ar="{`",ko={type:"literal",value:"{`",description:'"{`"'},g="`}",fi={type:"literal",value:"`}",description:'"`}"'},vr=function(n){return n},go=function(n){return c(["raw",n.join("")])},ns={type:"other",description:"comment"},yr="{!",ts={type:"literal",value:"{!",description:'"{!"'},nt="!}",ei={type:"literal",value:"!}",description:'"!}"'},is=function(n){return c(["comment",n.join("")])},rs=/^[#?\^><+%:@\/~%]/,us={type:"class",value:"[#?\\^><+%:@\\/~%]",description:"[#?\\^><+%:@\\/~%]"},fs="{",es={type:"literal",value:"{",description:'"{"'},os="}",ss={type:"literal",value:"}",description:'"}"'},hs="[",cs={type:"literal",value:"[",description:'"["'},ls="]",as={type:"literal",value:"]",description:'"]"'},vs="\n",ys={type:"literal",value:"\n",description:'"\\n"'},pr="\r\n",ps={type:"literal",value:"\r\n",description:'"\\r\\n"'},ws="\r",bs={type:"literal",value:"\r",description:'"\\r"'},ks="\u2028",ds={type:"literal",value:"\u2028",description:'"\\u2028"'},gs="\u2029",nh={type:"literal",value:"\u2029",description:'"\\u2029"'},th=/^[\t\x0B\f \xA0\uFEFF]/,ih={type:"class",value:"[\\t\\x0B\\f \\xA0\\uFEFF]",description:"[\\t\\x0B\\f \\xA0\\uFEFF]"},i=0,o=0,ut=0,oi={line:1,column:1,seenCR:!1},yt=0,si=[],u=0;if("startRule"in st){if(!(st.startRule in nr))throw new Error("Can't start parsing from rule \""+st.startRule+'".');tr=nr[st.startRule]}if(ot=tr(),ot!==r&&i===t.length)return ot;throw ot!==r&&i<t.length&&e({type:"end",description:"end of input"}),hi(null,si,yt);}return t(n,Error),{SyntaxError:n,parse:i}}();return n.parse=t.parse,t}),function(n,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.compile",["dust.core","dust.parse"],function(n,i){return t(i,n).compile}):"object"==typeof exports?module.exports=t(require("./parser").parse,require("./dust")):t(n.dust.parse,n.dust)}(this,function(n,t){function l(n){return i.filterNode({},n)}function r(n,t){for(var u,e=[t[0]],r=1,f=t.length;f>r;r++)u=i.filterNode(n,t[r]),u&&e.push(u);return e}function a(n,t){for(var u,r,e=[t[0]],f=1,o=t.length;o>f;f++)r=i.filterNode(n,t[f]),r&&("buffer"===r[0]||"format"===r[0]?u?(u[0]="buffer"===r[0]?"buffer":u[0],u[1]+=r.slice(1,-2).join("")):(u=r,e.push(r)):(u=null,e.push(r)));return e}function v(n,t){return["buffer",c[t[1]],t[2],t[3]]}function u(n,t){return t}function e(){}function y(n,i){return t.config.whitespace?(i.splice(1,2,i.slice(1,-2).join("")),i):null}function p(n,r){var f,e={name:r,bodies:[],blocks:{},index:0,auto:"h"},o=t.escapeJs(r),c=r?'"'+o+'",':"",u="function(dust){",h=i.compileNode(e,n);return r&&(u+='dust.register("'+o+'",'+h+");"),u+=w(e)+b(e)+"return "+h+"}",f="("+u+"(dust));",t.config.amd?"define("+c+'["dust.core"],'+u+");":t.config.cjs?"module.exports=function(dust){var tmpl="+f+"var f="+s().toString()+";f.template=tmpl;return f}":f}function w(n){var t,i=[],r=n.blocks;for(t in r)i.push('"'+t+'":'+r[t]);return i.length?(n.blocks="ctx=ctx.shiftBlocks(blocks);","var blocks={"+i.join(",")+"};"):(n.blocks="",n.blocks)}function b(n){for(var r=[],u=n.bodies,f=n.blocks,t=0,i=u.length;i>t;t++)r[t]="function body_"+t+"(chk,ctx){"+f+"return chk"+u[t]+";}body_"+t+".__dustBody=!0;";return r.join("")}function h(n,t){for(var f="",r=1,u=t.length;u>r;r++)f+=i.compileNode(n,t[r]);return f}function o(n,r,u){return"."+(t._aliases[u]||u)+"("+i.compileNode(n,r[1])+","+i.compileNode(n,r[2])+","+i.compileNode(n,r[4])+","+i.compileNode(n,r[3])+")"}function k(n){return n.replace(tt,"\\\\").replace(it,'\\"').replace(rt,"\\f").replace(ut,"\\n").replace(ft,"\\r").replace(et,"\\t")}function d(n,i,r){var u=t.loadSource(t.compile(n));return s(u)(i,r)}function g(n,i){var r=t.loadSource(t.compile(n,i));return s(r)}function s(n){return function(i,r){var u=r?"render":"stream";return t[u](n,i,r)}}var i={},nt=t.isArray,c;i.compile=function(t,i){try{var u=l(n(t));return p(u,i)}catch(r){if(!r.line||!r.column)throw r;throw new SyntaxError(r.message+" At line : "+r.line+", column : "+r.column);}};i.filterNode=function(n,t){return i.optimizers[t[0]](n,t)};i.optimizers={body:a,buffer:u,special:v,format:y,reference:r,"#":r,"?":r,"^":r,"<":r,"+":r,"@":r,"%":r,partial:r,context:r,params:r,bodies:r,param:r,filters:u,key:u,path:u,literal:u,raw:u,comment:e,line:e,col:e};i.pragmas={esc:function(n,t,i){var r,u=n.auto;return t||(t="h"),n.auto="s"===t?"":t,r=h(n,i.block),n.auto=u,r}};c={s:" ",n:"\n",r:"\r",lb:"{",rb:"}"};i.compileNode=function(n,t){return i.nodes[t[0]](n,t)};i.nodes={body:function(n,t){var i=n.index++,r="body_"+i;return n.bodies[i]=h(n,t),r},buffer:function(n,t){return".w("+f(t[1])+")"},format:function(n,t){return".w("+f(t[1])+")"},reference:function(n,t){return".f("+i.compileNode(n,t[1])+",ctx,"+i.compileNode(n,t[2])+")"},"#":function(n,t){return o(n,t,"section")},"?":function(n,t){return o(n,t,"exists")},"^":function(n,t){return o(n,t,"notexists")},"<":function(n,t){for(var u,e,f=t[4],r=1,o=f.length;o>r;r++)if(u=f[r],e=u[1][1],"block"===e)return n.blocks[t[1].text]=i.compileNode(n,u[2]),"";return""},"+":function(n,t){return"undefined"==typeof t[1].text&&"undefined"==typeof t[4]?".b(ctx.getBlock("+i.compileNode(n,t[1])+",chk, ctx),"+i.compileNode(n,t[2])+", {},"+i.compileNode(n,t[3])+")":".b(ctx.getBlock("+f(t[1].text)+"),"+i.compileNode(n,t[2])+","+i.compileNode(n,t[4])+","+i.compileNode(n,t[3])+")"},"@":function(n,t){return".h("+f(t[1].text)+","+i.compileNode(n,t[2])+","+i.compileNode(n,t[4])+","+i.compileNode(n,t[3])+")"},"%":function(n,t){var f,e,o,s,l,h,c,r,u,a=t[1][1];if(!i.pragmas[a])return"";for(f=t[4],e={},r=1,u=f.length;u>r;r++)h=f[r],e[h[1][1]]=h[2];for(o=t[3],s={},r=1,u=o.length;u>r;r++)c=o[r],s[c[1][1]]=c[2][1];return l=t[2][1]?t[2][1].text:null,i.pragmas[a](n,l,e,s)},partial:function(n,t){return".p("+i.compileNode(n,t[1])+",ctx,"+i.compileNode(n,t[2])+","+i.compileNode(n,t[3])+")"},context:function(n,t){return t[1]?"ctx.rebase("+i.compileNode(n,t[1])+")":"ctx"},params:function(n,t){for(var r=[],u=1,f=t.length;f>u;u++)r.push(i.compileNode(n,t[u]));return r.length?"{"+r.join(",")+"}":"{}"},bodies:function(n,t){for(var u=[],r=1,f=t.length;f>r;r++)u.push(i.compileNode(n,t[r]));return"{"+u.join(",")+"}"},param:function(n,t){return i.compileNode(n,t[1])+":"+i.compileNode(n,t[2])},filters:function(n,t){for(var u,i=[],r=1,f=t.length;f>r;r++)u=t[r],i.push('"'+u+'"');return'"'+n.auto+'"'+(i.length?",["+i.join(",")+"]":"")},key:function(n,t){return'ctx.get(["'+t[1]+'"], false)'},path:function(n,t){for(var e=t[1],u=t[2],f=[],r=0,o=u.length;o>r;r++)f.push(nt(u[r])?i.compileNode(n,u[r]):'"'+u[r]+'"');return"ctx.getPath("+e+", ["+f.join(",")+"])"},literal:function(n,t){return f(t[1])},raw:function(n,t){return".w("+f(t[1])+")"}};var tt=/\\/g,it=/"/g,rt=/\f/g,ut=/\n/g,ft=/\r/g,et=/\t/g,f="undefined"==typeof JSON?function(n){return'"'+k(n)+'"'}:JSON.stringify;return t.compiler=i,t.compile=t.compiler.compile,t.renderSource=d,t.compileFn=g,t.filterNode=i.filterNode,t.optimizers=i.optimizers,t.pragmas=i.pragmas,t.compileNode=i.compileNode,t.nodes=i.nodes,i});"function"==typeof define&&define.amd&&define.amd.dust===!0&&define(["require","dust.core","dust.compile"],function(n,t){return t.onLoad=function(t,i){n([t],function(){i()})},t});(function(n,t){typeof define=="function"&&define.amd&&define.amd.dust===!0?define(["dust.core"],t):typeof exports=="object"?module.exports=t(require("dustjs-linkedin")):t(n.dust)})(this,function(n){function t(t,i,r){r=r||"INFO";t=t?"{@"+t+"}: ":"";n.log(t+i,r)}function c(n){u[n]||(t(n,"Deprecation warning: "+n+" is deprecated and will be removed in a future version of dustjs-helpers","WARN"),t(null,"For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+n.replace(/\W+/g,""),"WARN"),u[n]=!0)}function l(n){return n.stack.tail&&n.stack.tail.head&&typeof n.stack.tail.head.__select__!="undefined"}function r(n){return l(n)&&n.get("__select__")}function f(n,t){var f=n.stack.head,u=n.rebase(),i,r;n.stack&&n.stack.tail&&(u.stack=n.stack.tail);r={isPending:!1,isResolved:!1,isDeferredComplete:!1,deferreds:[]};for(i in t)r[i]=t[i];return u.push({__select__:r}).push(f,n.stack.index,n.stack.of)}function e(n){var t,i;if(n.isDeferredPending=!0,n.deferreds.length)for(n.isDeferredComplete=!0,t=0,i=n.deferreds.length;t<i;t++)n.deferreds[t]();n.isDeferredPending=!1}function a(n,t){return typeof t=="function"?t.toString().replace(/(^\s+|\s+$)/mg,"").replace(/\n/mg,"").replace(/,\s*/mg,", ").replace(/\)\{/mg,") {"):t}function i(n,t){return function(i,r,u,f){return v(i,r,u,f,n,t)}}function v(n,i,u,f,e,s){var a=u.block,v=u["else"],h=r(i)||{},y,c,p,l;if(h.isResolved&&!h.isDeferredPending)return n;if(f.hasOwnProperty("key"))c=f.key;else if(h.hasOwnProperty("key"))c=h.key;else return t(e,"No key specified","WARN"),n;return l=f.type||h.type,c=o(i.resolve(c),l),p=o(i.resolve(f.value),l),s(c,p)?(h.isPending||(y=!0,h.isPending=!0),a&&(n=n.render(a,i)),y&&(h.isResolved=!0)):v&&(n=n.render(v,i)),n}function o(n,t){t&&(t=t.toLowerCase());switch(t){case"number":return+n;case"string":return String(n);case"boolean":return n=n==="false"?!1:n,Boolean(n);case"date":return new Date(n)}return n}var u={},s={tap:function(n,t,i){return c("tap"),i.resolve(n)},sep:function(n,t,i){var r=i.block;return t.stack.index===t.stack.of-1?n:r?r(n,t):n},first:function(n,t,i){return t.stack.index===0?i.block(n,t):n},last:function(n,t,i){return t.stack.index===t.stack.of-1?i.block(n,t):n},contextDump:function(n,i,r,u){var o=i.resolve(u.to),s=i.resolve(u.key),e,f;switch(s){case"full":e=i.stack;break;default:e=i.stack.head}f=JSON.stringify(e,a,2);switch(o){case"console":t("contextDump",f);break;default:f=f.replace(/</g,"\\u003c");n=n.write(f)}return n},math:function(n,i,u,o){var h=o.key,l=o.method,c=o.operand,a=o.round,s;if(!o.hasOwnProperty("key")||!o.method)return t("math","`key` or `method` was not provided","ERROR"),n;h=parseFloat(i.resolve(h));c=parseFloat(i.resolve(c));switch(l){case"mod":c===0&&t("math","Division by 0","ERROR");s=h%c;break;case"add":s=h+c;break;case"subtract":s=h-c;break;case"multiply":s=h*c;break;case"divide":c===0&&t("math","Division by 0","ERROR");s=h/c;break;case"ceil":case"floor":case"round":case"abs":s=Math[l](h);break;case"toint":s=parseInt(h,10);break;default:t("math","Method `"+l+"` is not supported","ERROR")}return typeof s!="undefined"&&(a&&(s=Math.round(s)),u&&u.block?(i=f(i,{key:s}),n=n.render(u.block,i),e(r(i))):n=n.write(s)),n},select:function(n,i,u,o){var h=u.block,s={};return o.hasOwnProperty("key")&&(s.key=i.resolve(o.key)),o.hasOwnProperty("type")&&(s.type=o.type),h?(i=f(i,s),n=n.render(h,i),e(r(i))):t("select","Missing body block","WARN"),n},eq:i("eq",function(n,t){return n===t}),ne:i("ne",function(n,t){return n!==t}),lt:i("lt",function(n,t){return n<t}),lte:i("lte",function(n,t){return n<=t}),gt:i("gt",function(n,t){return n>t}),gte:i("gte",function(n,t){return n>=t}),any:function(n,i,u){var f=r(i);return f?f.isDeferredComplete?t("any","Must not be nested inside {@any} or {@none} block","ERROR"):n=n.map(function(n){f.deferreds.push(function(){f.isResolved&&(n=n.render(u.block,i));n.end()})}):t("any","Must be used inside a {@select} block","ERROR"),n},none:function(n,i,u){var f=r(i);return f?f.isDeferredComplete?t("none","Must not be nested inside {@any} or {@none} block","ERROR"):n=n.map(function(n){f.deferreds.push(function(){f.isResolved||(n=n.render(u.block,i));n.end()})}):t("none","Must be used inside a {@select} block","ERROR"),n},size:function(t,i,r,u){var f=u.key,e,o;if(f=i.resolve(u.key),f&&f!==!0)if(n.isArray(f))e=f.length;else if(!isNaN(parseFloat(f))&&isFinite(f))e=f;else if(typeof f=="object"){e=0;for(o in f)f.hasOwnProperty(o)&&e++}else e=(f+"").length;else e=0;return t.write(e)}};for(var h in s)n.helpers[h]=s[h];return n});