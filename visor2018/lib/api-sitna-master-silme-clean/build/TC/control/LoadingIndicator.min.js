TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.LoadingIndicator=function(){var t=this;TC.Control.apply(t,arguments);window.addEventListener("error",function(){t.reset();return!1},!1)};TC.inherit(TC.control.LoadingIndicator,TC.Control);!function(){var t=TC.control.LoadingIndicator.prototype;t.CLASS="tc-ctl-load";TC.isDebug?t.template=TC.apiLocation+"TC/templates/LoadingIndicator.html":t.template=function(){dust.register(t.CLASS,o);function o(t,o){return t.w('<div class="tc-ctl-load-bar"><div class="tc-ctl-load-dots tc-ctl-load-dot1"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot2"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot3"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot4"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot5"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot6"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot7"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot8"> </div></div>')}o.__dustBody=!0;return o};t.waits={};t.startWait=function(o){void 0===t.waits[o.layer.id]&&(t.waits[o.layer.id]=0);t.waits[o.layer.id]=t.waits[o.layer.id]+1;this.show();this.map.$events.trigger($.Event(TC.Consts.event.STARTLOADING))};t.stopWait=function(o){var i=t.waits[o.layer.id];i>0&&(i=t.waits[o.layer.id]=i-1);i||delete t.waits[o.layer.id];var n=0;for(var s in t.waits)n++;if(!n){this.map?this.map.isLoaded&&this.hide():this.hide();this.map.$events.trigger($.Event(TC.Consts.event.STOPLOADING))}};t.reset=function(o){t.waits={};this.hide();this.map.$events.trigger($.Event(TC.Consts.event.STOPLOADING))};t.register=function(t){var o=this;TC.Control.prototype.register.call(o,t);t.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFORELAYERUPDATE+" "+TC.Consts.event.BEFOREFEATURESADD,function(t){o.startWait(t)}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.LAYERERROR+" "+TC.Consts.event.LAYERUPDATE+" "+TC.Consts.event.FEATURESADD,function(t){o.stopWait(t)}).on(TC.Consts.event.BEFOREFEATUREINFO,function(t){o.addWait(TC.Consts.event.FEATUREINFO)}).on(TC.Consts.event.FEATUREINFO+" "+TC.Consts.event.NOFEATUREINFO+" "+TC.Consts.event.FEATUREINFOERROR,function(t){o.removeWait(TC.Consts.event.FEATUREINFO)});if(!TC.isDebug){window.addEventListener("error",function(t,i,n,s,e){o.reset();return!1});$(document).ajaxError(function(t,i,n){o.reset()})}};t.addWait=function(t){var o=t||TC.getUID();this.startWait({layer:{id:o}});return o};t.removeWait=function(t){this.stopWait({layer:{id:t}})}}();