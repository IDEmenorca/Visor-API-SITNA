TC.control=TC.control||{};TC.Control=function(){this.$events=$(this);this.map=null;this.isActive=!1;this.isDisabled=!1;this._firstRender=$.Deferred();var t=arguments.length;this.options=$.extend({},t>1?arguments[1]:arguments[0]);this.id=this.options.id||TC.getUID(this.CLASS.substr(TC.Control.prototype.CLASS.length+1)+"-");this.div=TC.Util.getDiv(this.options.div?this.options.div:arguments[0]);this._$div=$(this.div);this._$div.addClass(TC.Control.prototype.CLASS).addClass(this.CLASS);this.template=this.options.template||this.template;this.exportsState=!1};TC.Control.prototype.on=function(t,e){this.$events.on(t,e);return this};TC.Control.prototype.one=function(t,e){this.$events.one(t,e);return this};TC.Control.prototype.off=function(t,e){this.$events.off(t,e);return this};TC.Control.prototype.CLASS="tc-ctl";TC.Control.prototype.template="";TC.Control.prototype.show=function(){this._$div.show()};TC.Control.prototype.hide=function(){this._$div.hide()};TC.Control.prototype.render=function(t){this.renderData(null,t)};TC.Control.prototype.renderData=function(t,e){var o=this;if(o.map){var i=$.Event(TC.Consts.event.BEFORECONTROLRENDER,{dataObject:t});o.$events.trigger(i)}o._$div.toggleClass(TC.Consts.classes.DISABLED,o.isDisabled);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){var i,n=function(e){var i=$.Deferred(),n=[];for(var r in e){var s=e[r];if("string"==typeof s)if(dust.cache[o.CLASS])dust.render(o.CLASS,t,function(t,e){o._$div.html(e);t&&TC.error(t)});else{var l=$.ajax({url:s,type:"get",dataType:"html"});l.templateKey=r;n.push(l)}else $.isFunction(s)&&s()}0==n.length?i.resolve():$.when.apply($,n).then(function(){if(3!=arguments.length||$.isArray(arguments[0]))for(var t=0;t<arguments.length;t++){var e=arguments[t];o=e[0],n=e[2].templateKey,r=dust.compile(o,n);dust.loadSource(r)}else{var o=arguments[0],n=arguments[2].templateKey,r=dust.compile(o,n);dust.loadSource(r)}i.resolve()},function(t,e,o){console.error("Deferred fallido")});return i};if("object"==typeof o.template)i=n(o.template);else{var r={};o.template&&(r[o.CLASS]=o.template);i=n(r)}i.then(function(){dust.cache[o.CLASS]&&dust.render(o.CLASS,t,function(t,e){o._$div.html(e);t&&TC.error(t)});o._firstRender.resolve();o.$events.trigger($.Event(TC.Consts.event.CONTROLRENDER));$.isFunction(e)&&e()})})};TC.Control.prototype.getRenderedHtml=function(t,e,o){var i=this,n=$.Deferred(),r=function(){dust.cache[t]&&dust.render(t,e,function(t,e){if(t){TC.error(t);n.reject()}else{$.isFunction(o)&&o(e);n.resolve(e)}})};TC.loadJSInOrder(!window.dust,TC.url.templating,function(){if(dust.cache[t])r();else{var e=i.template[t];if("string"==typeof e)$.ajax({url:e,type:"get",dataType:"html"}).done(function(){var e=arguments[0],o=dust.compile(e,t);dust.loadSource(o);r()});else if($.isFunction(e)){e();r()}}});return n};TC.Control.prototype.register=function(t){this.map=t;this.render();this.options.active&&this.activate()};TC.Control.prototype.activate=function(){if(this.map&&this.map.activeControl&&this.map.activeControl!=this){this.map.previousActiveControl=this.map.activeControl;TC.control.ThreeD&&this instanceof TC.control.ThreeD||this.map.activeControl.deactivate()}this.isActive=!0;if(this.map){this.map.activeControl=this;this.map.$events.trigger($.Event(TC.Consts.event.CONTROLACTIVATE,{control:this}));this.$events.trigger($.Event(TC.Consts.event.CONTROLACTIVATE,{control:this}))}};TC.Control.prototype.deactivate=function(t){0==arguments.length&&(t=!1);this.isActive=!1;if(this.map){this.map.activeControl=null;if(!t){var e=this.map.getDefaultControl();e==this?e=null:this.map.previousActiveControl==this?e=null:e||(e=this.map.previousActiveControl);e&&e.activate()}this.map.$events.trigger($.Event(TC.Consts.event.CONTROLDEACTIVATE,{control:this}));this.$events.trigger($.Event(TC.Consts.event.CONTROLDEACTIVATE,{control:this}))}};TC.Control.prototype.enable=function(){this.isDisabled=!1;this._$div&&this._$div.removeClass(TC.Consts.classes.DISABLED)};TC.Control.prototype.disable=function(){this.isDisabled=!0;this._$div&&this._$div.addClass(TC.Consts.classes.DISABLED)};TC.Control.prototype.renderPromise=function(){return this._firstRender.promise()};TC.Control.prototype.isExclusive=function(){return!1};TC.Control.prototype.getLocaleString=function(t,e){var o=this.map?this.map.options.locale:TC.Cfg.locale;return TC.Util.getLocaleString(o,t,e)};TC.Control.prototype.getUID=function(){return TC.getUID(this.id+"-")};TC.Control.prototype.exportState=function(){return this.exportsState?{}:null};TC.Control.prototype.importState=function(t){};