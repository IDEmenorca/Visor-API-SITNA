TC.Util.ExcelExport=function(){this.stringifyField=function(e,t,r){if("string"==typeof e){e=e.replace(/"/g,'""');(r||e.indexOf(",")>-1||e.indexOf("\n")>-1||e.indexOf("\r")>-1)&&(e=t+e+t);return e}return"boolean"==typeof e?e?"TRUE":"FALSE":e};this.stringify=function(e,t){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=String.fromCharCode,n=function(){try{document.createElement("$")}catch(e){return e}}();window.btoa||(window.btoa=function(e){for(var t,o,a,i,l,s,c=0,d=e.length,m=Math.max,p="";c<d;){if(m(t=e.charCodeAt(c++)||0,o=e.charCodeAt(c++)||0,s=e.charCodeAt(c++)||0)>255)throw n;a=(3&t)<<4|o>>4&15;i=(15&o)<<2|s>>6&3;l=63&s;o?s||(l=64):i=l=64;p+=r.charAt(t>>2&63)+r.charAt(a)+r.charAt(i)+r.charAt(l)}return p});window.atob||(window.atob=function(e){var t,a,i,l,s,c,d,m=0,p=(e=e.replace(/=+$/,"")).length,f=[];if(p%4==1)throw n;for(;m<p;){i=r.indexOf(e.charAt(m++));l=r.indexOf(e.charAt(m++));s=r.indexOf(e.charAt(m++));c=r.indexOf(e.charAt(m++));t=(63&i)<<2|l>>4&3;a=(15&l)<<4|s>>2&15;d=(3&s)<<6|63&c;f.push(o(t));a&&f.push(o(a));d&&f.push(o(d))}return f.join("")});var a=[];$.isArray(e)?a=e:$.isFunction(e)&&(a=e());for(var i='<thead valign="top">',l=0;l<1;l++){i+="<tr>";for(var s in a[l])a[l].hasOwnProperty(s)&&(i+="<th>"+a[l][s]+"</th>");i+="</tr>"}i+="</thead>";i+="<tbody>";var c=1.1.toLocaleString(navigator.language).substring(1,2);for(1e3.toLocaleString(navigator.language).substring(1,2),l=1;l<a.length;l++){i+="<tr>";for(s=0;s<a[l].length;s++)if(a[l].hasOwnProperty(s)){var d,m=a[l][s];if(null===m||"string"!=typeof m&&"number"!=typeof m)d="string";else{m.value&&(m=m.value);if(-1!=(""+m).indexOf("%")){m=m.replace(" %","%").replace(/\.|,/g,c);d="percent"}else{var p=0;m&&(p="number"==typeof m?m:new Number(m.replace?m.replace(/\./g,"").replace(/,/g,".").trim():m.trim()));if(isNaN(p))d=/^\d{1,2}([.\/-])\d{1,2}\1(\d{4}|\d{2})$/.test(m)?"date":"string";else{m=p.toString().replace(".",c);d=p%1>0?"number2d":"number"}}}i+='<td class="'+d+'"';if(m&&(m.hasOwnProperty("rowspan")||m.hasOwnProperty("colspan"))){m.hasOwnProperty("rowspan")&&(i+=' valign="top" rowspan="'+m.rowspan+'">'+m.value+"</td>");m.hasOwnProperty("colspan")&&(i+=' colspan="'+m.colspan+'">'+m.value+"</td>");s++}else i+=">"+(null==m?"":m)+"</td>"}i+="</tr>"}i+="</tbody>";var f='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name=ProgId content=Excel.Sheet><meta name=Generator content="Microsoft Excel 9">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>';f+=","===c?'\x3c!--table{mso-displayed-decimal-separator:","; mso-displayed-thousand-separator:".";}':'\x3c!--table{mso-displayed-decimal-separator:"."; mso-displayed-thousand-separator:",";}';f+="body {visibility:hidden;}";f+='.number{mso-number-format:"#,##0";} .number2d{mso-number-format:"#,##0.00";} .percent{mso-number-format:0.00%;} ';f+='.date{mso-number-format:"dd/mm/yyyy";} .string{mso-number-format:"@";} caption{text-align:left;}--\x3e</style></head><body><table><caption>{caption}</caption>{table}</table></body></html>';var h,u={worksheet:t.workSheet||"Hoja1",table:i,caption:t.title||""};return h=u,f.replace(/{(\w+)}/g,function(e,t){return h[t]})}};TC.Util.ExcelExport.prototype.Save=function(e,t,r){for(var o,n=function(e){for(var t="",r=0;r<e.length;r++){var o=null===e[r]?"":e[r].toString();e[r]instanceof Date&&(o=e[r].toLocaleString());var n=o.replace(/"/g,'""');n.search(/("|,|\n)/g)>=0&&(n='"'+n+'"');r>0&&(t+="\t");t+=n}return t+"\n"},a=0;a<t.length;a++)o+=n(t[a]);var i;o=this.stringify(t,{txtDelim:'"',fieldSep:";",title:r||""});if(TC.Util.detectIE()){if(document.execCommand){var l=window.open("about:blank","_blank");l.document.write(o);l.document.close();l.document.execCommand("SaveAs",!0,e);l.close()}}else{o="data:application/vnd.ms-excel;base64,"+(i=o,window.btoa(unescape(encodeURIComponent(i))));var s=$("<a></a>");s.attr("href",o);s.attr("download",e);$("body").append(s);window.setTimeout(function(){s[0].click();s.remove()},null)}};